(function(){
	'use strict';
	angular
		.module('webraovatApp')
		.controller('UserCreateUpdateController', UserCreateUpdateController);
	
	UserCreateUpdateController.$inject = ['$scope', '$http', '$filter'];
	function UserCreateUpdateController($scope, $http, $filter){
		var vm = this;
		vm.user = {};
		vm.load = load;
		
		vm.load();
		function load() {
			if(vm.user.birthday) {
				vm.user.birthday = new Date(vm.user.birthday);
				console.log(vm.user.birthday);
			}
			/*var collectionDate = '2017-12-12'; 
		    vm.newDate =new Date(collectionDate);
		    console.log(vm.newDate);
			formatDataWhenLoad();*/
		}
		
		vm.save = function() {
			$scope.$broadcast('show-errors-check-validity');
			if ($scope.createUpdateForm.$invalid) {
				var invalidControl = angular.element('input.ng-invalid').first() || angular.element('select.ng-invalid').first() ||angular.element('option.ng-invalid').first();
				if (invalidControl != null) {
                    invalidControl.focus();
                }
			} else {
				formatDataBeforeSave();
				console.log(vm.user);
				$http({
		            url : 'UserController',
		            method : "POST",
		            headers: {
		            	Accept: "application/json; charset=utf-8",
		            	"Content-Type" : "application/json; charset=utf-8"
		            },
					data: JSON.stringify(vm.user)
		        }).then(function(response) {
		        	if(vm.user.birthday) {
						vm.user.birthday = new Date(vm.user.birthday);
						console.log(vm.user.birthday);
					}
		            console.log(response);
		        }, function(response) {
		            //fail case
		            console.log(response);
		        });
			}
		}
		
		function formatDataWhenLoad() {
			if(vm.user.birthday) {
				vm.user.birthday = new Date("2017-10-10");
				console.log("formatDataWhenLoad", vm.user.birthday);
			}
		}
		
		function formatDataBeforeSave() {
			vm.user.birthday = $filter('date')(vm.user.birthday, 'yyyy-MM-dd');
			console.log(vm.user.birthday);
		}
	}
	
})();