(function(){
	'use strict';
	angular
		.module('webraovatApp')
		.controller('UserDetailController', UserDetailController);
	
	UserDetailController.$inject = ['userID', '$http', '$uibModal'];
	function UserDetailController(userID, $http, $uibModal){
		var vm = this;
		vm.user = {};
		vm.alerts = [];
		vm.load = load;
		vm.load();
		
		function load(){
			showAlert();
			$http({
				url: "UserController?action=detail",
				method: "POST",
				params: {
					userID: userID
				}
			}).then(function(response) {
				vm.user = response.data;
				formatData();
	        }, function(response) {
	            console.log(response);
	        });
		}
		
		function formatData(){
			if(vm.user.birthday) {
				vm.user.birthday = new Date(vm.user.birthday);
			}
			vm.user.level = vm.user.level.toString();
			vm.user.gender = vm.user.gender.toString(); 
		}
		
		vm.delete = function(userID) {
			vm.modalInstantDeleteUser = $uibModal.open({
                templateUrl: 'app/admin/user/user-delete-dialog.html',
                controller: 'UserDeleteController',
                controllerAs: 'vm',
                size: 'md',
                resolve: {
                    userID: function() {
                        return userID;
                    }
                }
            });
		}
		vm.block = function(userID) {
			vm.modalInstantDeleteUser = $uibModal.open({
                templateUrl: 'app/admin/user/user-block-dialog.html',
                controller: 'UserBlockController',
                controllerAs: 'vm',
                size: 'md',
                resolve: {
                    userID: function() {
                        return userID;
                    }
                }
            });
			vm.modalInstantDeleteUser.result.then(function(){
				var alert = { type: 'success', msg: 'Khóa user thành công!'};
				vm.alerts.push(alert);
			})
		} 
		
		function showAlert() {
			$scope.$on('update-success', function(){
				var alert = { type: 'success', msg: 'Cập nhật user thành công!'};
				vm.alerts.push(alert);
			});
		}
		
		vm.closeAlert = function(index) {
		    vm.alerts.splice(index, 1);
		};
	}
	
})();